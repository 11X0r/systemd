# SPDX-License-Identifier: LGPL-2.1-or-later

server:
    rundir: "/run/knot"
    user: knot:knot
    listen: 1.2.3.1@53

log:
    - target: syslog
      any: info

database:
    storage: "/var/lib/knot"

acl:
    - id: update_acl
      address: 1.2.3.0/24
      action: update

remote:
    - id: parent_zone_server
      address: 1.2.3.1@53

submission:
    - id: parent_zone_sbm
      check-interval: 2s
      parent: [parent_zone_server]

# Auto ZSK/KSK rollover for DNSSEC-enabled zones + pushing the respective DS
# records to the parent zone
policy:
    - id: auto_rollover
      signing-threads: 4
      algorithm: ECDSAP256SHA256
      zsk-lifetime: 60d
      ksk-lifetime: 365d
      ksk-submission: parent_zone_sbm
      cds-cdnskey-publish: always
      ds-push: parent_zone_server
      propagation-delay: 1s
      zone-max-ttl: 1s

# Manual ZSK/KSK management
policy:
    - id: manual
      manual: on

template:
    - id: default
      storage: "/var/lib/knot/zones"
      file: "%s.zone"
      dnssec-signing: on
      dnssec-policy: auto_rollover
      semantic-checks: on
      acl: update_acl

template:
    - id: unsigned
      storage: "/var/lib/knot/zones"
      file: "%s.zone"
      dnssec-signing: off
      semantic-checks: on

zone:
    # Create our own DNSSEC-enable root zone, so we can test the whole chain of
    # trust. This needs a ZSK/KSK keypair to be generated before running knot +
    # adding the respective key(s) to resolved's trust anchor store (see the
    # test script for the setup steps).
    - domain: .
      dnssec-policy: manual
      file: "root.zone"

    - domain: systemd
    - domain: dns.systemd

    - domain: unsigned.systemd
      template: unsigned
