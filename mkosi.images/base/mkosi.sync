#!/bin/bash
# SPDX-License-Identifier: LGPL-2.1-or-later
set -e

if ((CACHED)); then
    exit 0
fi

if [ -z "$(ls --almost-all "pkg/$PKG_SUBDIR")" ]; then
    git clone "$PKG_URL" --branch "$PKG_BRANCH" "pkg/$PKG_SUBDIR"
elif [ -d "pkg/$PKG_SUBDIR/.git" ] && [ "$(git -C "pkg/$PKG_SUBDIR" rev-parse --abbrev-ref HEAD)" = "$PKG_BRANCH" ]; then
    git -C "pkg/$PKG_SUBDIR" pull
fi
